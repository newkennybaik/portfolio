"use strict";(self.webpackChunkvidyoconnect=self.webpackChunkvidyoconnect||[]).push([[479],{4860:(e,a,n)=>{n.r(a),n.d(a,{initBanubaPlugin:()=>d});var t=n(9442),o=n(8144),i=n(119),r=n(9448),c=n(3298),l=n(8574);async function d(){const e=new URLSearchParams(window.location.search).get("effect")||"Camera_background";let a;const n="webar_".concat((new Date).valueOf());let d,s;window.isSafariBrowser&&navigator.serviceWorker.register("banuba/range-requests.sw.js"),await(0,l.k0)("banuba/token.js");const u=window.banubaToken;try{[d,s]=await Promise.all([t.ai.create({locateFile:{"BanubaSDK.data":r,"BanubaSDK.wasm":o,"BanubaSDK.simd.wasm":i},clientToken:u,devicePixelRatio:1,proxyVideoRequestsTo:window.isSafariBrowser?"___range-requests___/":null}),t.nV.preload([c])]),await d.addModule(...s),window.isBanubaTokenValid=!0,a=!0}catch(y){console.error(y),window.isBanubaTokenValid=!1,a=!1}const w=new CustomEvent("BanubaTokenValid",{bubbles:!0,detail:{isValid:a}});if(window.document.body.dispatchEvent(w),!d||!a)return;const f=await t.Mj.preload("banuba/".concat(e,".zip")),b=document.createElement("div");b.id=n,b.style="\n     position: absolute !important;\n     top: -9999px !important;\n     left: -9999px !important;\n     display: !important;\n   ",document.body.appendChild(b);let p=!1;const v=localStorage.getItem("VIDYO_CONNECT");let g;v&&(g=JSON.parse(v).selectedCameraEffect),g&&(await d.applyEffect(f),"blur"===g.id?(f.evalJs("Background.blur(0.6)"),p=!0):(f.evalJs("Background.texture('".concat(g.name,".jpg')")),p=!0));let m=[],B=null;const h=e=>{e&&e.getVideoTracks().forEach((e=>{e.stop()}))};window.banuba={get isBanubaInited(){return p},clearEffect:()=>d.clearEffect(),applyEffect:async e=>{p=!0,await d.applyEffect(f),"blur"===e?f.evalJs("Background.blur(0.6)"):f.evalJs("Background.texture('".concat(e,".jpg')"))},effectBackground:async(e,a)=>{var o,i;if(!p)return e;if(null!==(o=B)&&void 0!==o&&o.active&&a){h(e);const a=B.clone();return console.log("BANUBA: Called effectBackground for ".concat(e.id," and get effectedStreamCapture ").concat(a.id," from cache")),a}let r,c=window.isSafariBrowser&&window.isMobileOrTablet&&a;return d.use(new t.vs(e),{resize:(e,a)=>{try{if(c){var n,t,o,i;const r=null===(n=window.screen)||void 0===n||null===(t=n.orientation)||void 0===t||null===(o=t.type)||void 0===o||null===(i=o.startsWith)||void 0===i?void 0:i.call(o,"portrait");if((r||void 0===r&&window.innerHeight>window.innerWidth)&&e>a)return[a,e]}}catch(y){return console.error("BANUBA: error during cheking screen orientation on ios Safari"),c=!1,[e,a]}return[e,a]},horizontalFlip:!1}),document.querySelector("#".concat(n," canvas"))&&t.Jf.unmount("#".concat(n)),t.Jf.render(d,"#".concat(n)),null!==(i=r)&&void 0!==i&&i.active||(r=new t.Pi(d)),r.addEventListener("inactive",(()=>{h(e)})),m.push(e),B=r,console.log("BANUBA: Called effectBackground for ".concat(e.id," and get fresh effectedStreamCapture ").concat(r.id)),await new Promise((e=>setTimeout(e,200))),r},getLastStream:()=>{var e;const a=null===(e=B)||void 0===e?void 0:e.clone();return console.log("BANUBA: Called getLastStream and get ".concat(a?a.id:"null"," from cache. LastStream is ").concat(B?B.id:"null")),a},stopStreams:()=>{console.log("BANUBA: Stop cached streams ".concat([B,...m].map((e=>(null===e||void 0===e?void 0:e.id)||"")).join(","))),[B,...m].forEach((e=>{h(e)})),m=[],B=null}},window.banubaPluginReady=!0;const k=new Event("BanubaPluginReady",{bubbles:!0});return window.document.body.dispatchEvent(k),!0}}}]);
//# sourceMappingURL=479.b8b00210.chunk.js.map