# Internal DNS Server Installation Overivew
- The purpose of DNS Server installation on internal organisation is as following reason:
```bash
1. 보안 강화 
- 외부 DNS를 참조하지 않아도 되므로, DNS 스푸핑, 캐시 포이즈닝 등의 공격을 예방 가능. 
- 망 분리 환경에서 필수
- 내부 IP나 시스템 정보 노출 방지. 외부에 민감한 서버 주소가 노출되지 않음.

2. 운영 효율성 
- 내부 시스템 (예: 파일서버, ERP, 내부 웹사이트 등)에 고정된 도메인 네임을 부여해 관리 용이성
- IP 변경 시에도 사용자 단은 도메인만 유지하면 되므로 유지보수가 간편함.

3. 서비스 가용성 향상
- 외부 DNS 서비스가 죽더라도 내부는 영향을 받지 않음 → 내부망은 계속 동작.
- 내부 네트워크 트래픽이 줄어들어 전체적인 응답 속도 향상.

4. 네임 컨벤션 관리
- mail.intranet.local, dev-server.corp.local 등 조직 내 통일된 네이밍 규칙 적용 가능
- 시스템, 부서, 역할별로 명확한 식별 가능 → IT 자산 관리 최적화.

5. 테스트 환경 구성
- 개발/테스트 환경에서 외부 DNS와 충돌 없이 자체적으로 구성 가능.
예: staging.example.com이 외부에는 존재하지 않지만 내부 DNS에서만 유효하도록 설정.

6. 로컬 리졸버 역할
- 내부 DNS는 자체적으로 DNS 캐싱 기능을 수행하여 응답 속도를 높이고, 외부 DNS 질의를 최소화함.
```

# Steps

## 1. Ubuntu/Rocky Linux에서 패키지 설치 진행
```bash
# yum -y install bind bind-utils
```

## 2. named.conf 수정
```
# vi /etc/named.conf
[named.conf]
//
// named.conf
//
// Provided by Red Hat bind package to configure the ISC BIND named(8) DNS
// server as a caching only nameserver (as a localhost DNS resolver only).
//
// See /usr/share/doc/bind*/sample/ for example named configuration files.
//

options {
        listen-on port 53 { 127.0.0.1; 192.168.0.145; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
        secroots-file   "/var/named/data/named.secroots";
        recursing-file  "/var/named/data/named.recursing";

        allow-query     { any; };

        /*
         - If you are building an AUTHORITATIVE DNS server, do NOT enable recursion.
         - If you are building a RECURSIVE (caching) DNS server, you need to enable
           recursion.
         - If your recursive DNS server has a public IP address, you MUST enable access
           control to limit queries to your legitimate users. Failing to do so will
           cause your server to become part of large scale DNS amplification
           attacks. Implementing BCP38 within your network would greatly
           reduce such attack surface
        */
        recursion yes;

        dnssec-validation no;

        managed-keys-directory "/var/named/dynamic";
        geoip-directory "/usr/share/GeoIP";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";

        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */
        include "/etc/crypto-policies/back-ends/bind.config";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

zone "nownnow.com" IN {
        type master;
        file "nownnow.com.zone";
        allow-update { none; };
};


include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";


```

## 3. 내부 도메인 nownnow.com 선언 추가를 위에 해놨으므로, zone 파일 생성.
```bash
# vi /var/named/nownnow.com.zone
[nownnow.com.zone]
$TTL 86400
@   IN  SOA ns1.nownnow.com. admin.nownnow.com. (
        2025110301 ; Serial
        3600       ; Refresh
        900        ; Retry
        604800     ; Expire
        86400 )    ; Minimum
@       IN  NS  ns1.nownnow.com.
ns1     IN  A   192.168.0.145
vp      IN  A   192.168.0.100
vr1     IN  A   192.168.0.15
vr2     IN  A   192.168.0.16
vr3     IN  A   192.168.0.17
vrp     IN  A   192.168.0.37
vrp1    IN  A   192.168.0.38
vrp2    IN  A   192.168.0.39
vrp3    IN  A   192.168.0.40
vi      IN  A   192.168.0.14
~

```

## 4. 파일 권한 확인 후 재기동 (기본으로 설정은 되어있은 것임)
```bash
# chown root:named /var/named/nownnow.com.zone
# chmod 640 /var/named/nownnow.com.zone
# restorecon -Rv /var/named

# systemctl restart named
# systemctl status named
```

## 5. nslookup test
```bash
# nslookup
> server 192.168.0.145
Default server: 192.168.0.145
Address: 192.168.0.145#53
> vp.nownnow.com
Server:         192.168.0.145
Address:        192.168.0.145#53

Name:   vp.nownnow.com
Address: 192.168.0.100

```

## 6. 같은 네트워크 상 윈도우나 서버에 적용
```bash
Windows → 네트워크 어댑터 → IPv4 → DNS 서버를 192.168.0.145 로 설정
```

# Conclusion
- 설정이 크게 어렵지는 않음.
- 역방향 DNS (PTR) 추가
- 내부/외부 접속 분리용 View (Split DNS) 구성
- Master / Slave 이중화
- Let's Encrypt 또는 사설 CA 연동 (HTTPS 인증서 관리) 등 응용 가능.